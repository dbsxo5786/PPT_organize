# backend/services/keywords.py
from konlpy.tag import Okt
from collections import Counter

# Okt í˜•íƒœì†Œ ë¶„ì„ê¸° ì´ˆê¸°í™”
okt = Okt()

# ğŸ’¡ ëŒ€í­ ê°•í™”ëœ ë¶ˆìš©ì–´(Stopwords) ë¦¬ìŠ¤íŠ¸
STOPWORDS = {
    # ì¡°ì‚¬, ì ‘ë¯¸ì‚¬, ëŒ€ëª…ì‚¬ ë“± ê¸°ë³¸ ë¶ˆìš©ì–´
    'ì„', 'ë¥¼', 'ì´', 'ê°€', 'ì€', 'ëŠ”', 'ì—', 'ì™€', 'ê³¼', 'ì˜', 'ë¡œ', 'ìœ¼ë¡œ', 
    'ê²ƒ', 'ìˆ˜', 'ë“±', 'ë°', 'ê·¸', 'ì €', 'ì´', 'ê²ƒì…ë‹ˆë‹¤', 'ìˆìŠµë‹ˆë‹¤', 'í•©ë‹ˆë‹¤',
    'ì…ë‹ˆë‹¤', 'í•˜ê¸°', 'ìœ„í•´', 'í†µí•´', 'ëŒ€í•œ', 'ëŒ€í•´', 'ì—ì„œ', 'ì—ê²Œ', 'ê°™ì€',
    'ìš°ë¦¬', 'ëª¨ë“ ', 'ê·¸ë¦¬ê³ ', 'í•˜ì§€ë§Œ', 'ê·¸ëŸ¬ë‚˜',
    
    # ğŸ’¡ ì£¼ì œì™€ ê´€ë ¨ ì—†ëŠ” ì¼ë°˜ì ì¸ ëª…ì‚¬ ì¶”ê°€
    'ê°œë…', 'ë‚´ìš©', 'ëŒ€í‘œ', 'ë¶€ë¶„', 'ì‚¬ëŒ', 'ì‚¬ìš©', 'ì„¤ëª…', 'ì†Œê°œ', 'ì‹œëŒ€',
    'ì–¸ì–´', 'ì´í•´', 'ì‘ì„±', 'ì •ì˜', 'ì¢…ë¥˜', 'ì£¼ì œ', 'ì¤‘ìš”', 'íŠ¹ì§•', 'í˜•íƒœ',
    'í˜¸í™˜ì„±', 'ì•ˆì •', 'ì„±ê³¼', 'ìˆ˜ì¤€', 'ê³¼ì •', 'ë¹„êµ', 'ë¬¸ë²•', 'ìƒì‚°',
    'í”Œë«í¼', 'ë…ë¦½', 'ëŒ€ê·œëª¨', 'í”„ë¡œì íŠ¸', 'ì í•©', 'ì½”ë“œ', 'ë§ºìŒë§',
    
    # ğŸ’¡ ì˜ëª» ë¶„ë¦¬ë  ê°€ëŠ¥ì„±ì´ ìˆëŠ” ë‹¨ì–´ ì¡°ê° ì¶”ê°€ (ê°•ì œ í•„í„°ë§)
    'ì–´ë€', 'ë¦¬ê¸°', 'ë„ë¦¬'
}

def extract_keywords(text: str, max_keywords=10) -> list[str]:
    """
    ì£¼ì–´ì§„ í…ìŠ¤íŠ¸ì—ì„œ í˜•íƒœì†Œ ë¶„ì„ì„ í†µí•´ í•µì‹¬ ëª…ì‚¬ë¥¼ ì¶”ì¶œí•©ë‹ˆë‹¤.
    - ëª…ì‚¬ë§Œ ì¶”ì¶œí•˜ì—¬ ì–´ë¯¸/ì¡°ì‚¬ë¥¼ ì œê±°í•©ë‹ˆë‹¤.
    - í•œ ê¸€ì ë‹¨ì–´ì™€ ê°•í™”ëœ ë¶ˆìš©ì–´ë¥¼ ì œê±°í•©ë‹ˆë‹¤.
    - ë¹ˆë„ìˆ˜ ìˆœìœ¼ë¡œ ì •ë ¬í•˜ì—¬ ìƒìœ„ í‚¤ì›Œë“œë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
    """
    if not text:
        return []

    # 1. í˜•íƒœì†Œ ë¶„ì„ì„ í†µí•´ ëª…ì‚¬ë§Œ ì¶”ì¶œ
    nouns = okt.nouns(text)

    # 2. í•œ ê¸€ì ë‹¨ì–´, ë¶ˆìš©ì–´, ìˆ«ì ì œê±°
    words = [
        n for n in nouns 
        if len(n) > 1 and n not in STOPWORDS and not n.isdigit()
    ]

    # 3. ë‹¨ì–´ ë¹ˆë„ìˆ˜ ê³„ì‚°
    counter = Counter(words)

    # 4. ë¹ˆë„ìˆ˜ê°€ ë†’ì€ ìˆœìœ¼ë¡œ ì •ë ¬í•˜ì—¬ ìµœëŒ€ ê°œìˆ˜ë§Œí¼ ë°˜í™˜
    top_keywords = [word for word, freq in counter.most_common(max_keywords)]
    
    return top_keywords